# Migration `20201024004529-added-by-for-comments`

This migration has been generated by mcsdevv at 10/24/2020, 1:45:29 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."comments" DROP COLUMN "added_by",
ADD COLUMN "uid" text   NOT NULL 

CREATE INDEX "teams.handle_index" ON "public"."teams"("handle")

ALTER TABLE "public"."comments" ADD FOREIGN KEY ("uid")REFERENCES "public"."users"("uid") ON DELETE CASCADE ON UPDATE CASCADE

ALTER INDEX "public"."metadata_pkey" RENAME TO "metadata.url_unique"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201018211334-campaign-prod..20201024004529-added-by-for-comments
--- datamodel.dml
+++ datamodel.dml
@@ -4,9 +4,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model teams {
   tuid            String    @id @default("")
@@ -24,8 +24,10 @@
   reviewsRequired Int       @default(0) @map("reviews_required")
   creator         users     @relation(fields: [createdBy], references: [uid])
   members         members[]
   tweets          tweets[]
+
+  @@index([handle])
 }
 model members {
   uid  String @default("")
@@ -70,12 +72,13 @@
 model comments {
   tcuid   String   @id
   twuid   String
+  uid     String
   addedAt DateTime @default(now()) @map("added_at")
-  addedBy String   @map("added_by")
+  addedBy users    @relation(fields: [uid], references: [uid])
   comment String
-  tweets  tweets   @relation(fields: [twuid], references: [twuid])
+  tweet   tweets   @relation(fields: [twuid], references: [twuid])
 }
 model metadata {
   url                         String   @unique @default("")
@@ -115,14 +118,15 @@
   tweets                      tweets[]
 }
 model users {
-  uid       String    @id @default("")
-  email     String    @unique @default("")
-  name      String    @default("")
-  picture   String    @default("")
-  createdAt DateTime  @default(now()) @map("created_at")
-  updatedAt DateTime  @default(now()) @map("updated_at")
+  uid       String     @id @default("")
+  email     String     @unique @default("")
+  name      String     @default("")
+  picture   String     @default("")
+  createdAt DateTime   @default(now()) @map("created_at")
+  updatedAt DateTime   @default(now()) @map("updated_at")
   members   members[]
   teams     teams[]
   tweets    tweets[]
+  comments  comments[]
 }
```


