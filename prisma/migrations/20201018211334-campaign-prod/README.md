# Migration `20201018211334-campaign-prod`

This migration has been generated by mcsdevv at 10/18/2020, 10:13:34 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."metadata.twuid_unique"

DROP INDEX "public"."teams.handle_index"

DROP INDEX "public"."teams.handle_unique"

ALTER TABLE "public"."metadata" DROP CONSTRAINT "metadata_twuid_fkey"

ALTER TABLE "public"."metadata" DROP CONSTRAINT "metadata_pkey",
DROP COLUMN "twmuid",
DROP COLUMN "twuid",
ALTER COLUMN "url" SET NOT NULL,
ALTER COLUMN "url" SET DEFAULT E''

ALTER TABLE "public"."tweets" ADD COLUMN "url" text   

CREATE UNIQUE INDEX "metadata.url_unique" ON "public"."metadata"("url")

ALTER TABLE "public"."tweets" ADD FOREIGN KEY ("url")REFERENCES "public"."metadata"("url") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201010190557-title-to-campaign..20201018211334-campaign-prod
--- datamodel.dml
+++ datamodel.dml
@@ -1,32 +1,31 @@
 generator client {
-  provider = "prisma-client-js"
+  provider             = "prisma-client-js"
+  experimentalFeatures = ["connectOrCreate"]
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model teams {
   tuid            String    @id @default("")
   name            String    @default("")
   protected       Boolean
-  handle          String    @unique @default("")
+  handle          String    @default("")
   avatar          String    @default("")
-  reviewsRequired Int       @default(0) @map("reviews_required")
   plan            String    @default("")
   tokenSecret     String    @default("") @map("token_secret")
   tokenKey        String    @default("") @map("token_key")
   inviteCode      String    @default("") @map("invite_code")
   updatedAt       DateTime  @default(now()) @map("updated_at")
   createdAt       DateTime  @default(now()) @map("created_at")
   createdBy       String    @map("created_by")
+  reviewsRequired Int       @default(0) @map("reviews_required")
   creator         users     @relation(fields: [createdBy], references: [uid])
   members         members[]
   tweets          tweets[]
-
-  @@index([handle])
 }
 model members {
   uid  String @default("")
@@ -51,13 +50,14 @@
   tweetId          String      @map("tweet_id")
   retweets         Int
   replies          Int
   favorites        Int
+  url              String?
   creator          users       @relation(fields: [createdBy], references: [uid])
   team             teams       @relation(fields: [tuid], references: [tuid])
+  metadata         metadata?   @relation(fields: [url], references: [url])
   approvals        approvals[]
   comments         comments[]
-  metadata         metadata?
 }
 model approvals {
   tauid String
@@ -77,10 +77,9 @@
   tweets  tweets   @relation(fields: [twuid], references: [twuid])
 }
 model metadata {
-  twmuid                      String   @id @default("")
-  twuid                       String?  @unique
+  url                         String   @unique @default("")
   og_url                      String?
   og_type                     String?
   og_title                    String?
   og_img                      String?
@@ -112,10 +111,9 @@
   twitter_app_name_googleplay String?
   twitter_title               String?
   cardType                    String?
   fallbackImg                 Boolean?
-  url                         String?
-  tweet                       tweets?  @relation(fields: [twuid], references: [twuid])
+  tweets                      tweets[]
 }
 model users {
   uid       String    @id @default("")
```


